# Fundamentals - –û—Å–Ω–æ–≤—ã System Design

–§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º –∏ system design.

---

## –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º

### Latency (–ó–∞–¥–µ—Ä–∂–∫–∞)
**–í—Ä–µ–º—è**, –∫–æ—Ç–æ—Ä–æ–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è **–æ–¥–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏** (–æ—Ç –∑–∞–ø—Ä–æ—Å–∞ –¥–æ –æ—Ç–≤–µ—Ç–∞).

**–ò–∑–º–µ—Ä—è–µ—Ç—Å—è –≤:** –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö (ms), –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥–∞—Ö (Œºs), —Å–µ–∫—É–Ω–¥–∞—Ö (s)

**–ü—Ä–∏–º–µ—Ä—ã latency:**
```
L1 CPU cache:           0.5 ns      (–Ω–∞–Ω–æ—Å–µ–∫—É–Ω–¥—ã)
L2 CPU cache:           7 ns
RAM access:             100 ns
SSD read:               150 Œºs      (–º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥—ã)
HDD seek:               10 ms       (–º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã)
Network (same DC):      0.5 ms
Network (cross-region): 150 ms
Network (intercontinental): 300+ ms
```

**–ö–æ–≥–¥–∞ –∫—Ä–∏—Ç–∏—á–Ω–æ:**
- Real-time —Å–∏—Å—Ç–µ–º—ã (–∏–≥—Ä—ã, –≤–∏–¥–µ–æ–∑–≤–æ–Ω–∫–∏)
- Trading —Å–∏—Å—Ç–µ–º—ã
- User-facing API (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∂–¥—ë—Ç –æ—Ç–≤–µ—Ç–∞)

**–ö–∞–∫ —Å–Ω–∏–∑–∏—Ç—å:**
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ (Redis, CDN)
- –ò–Ω–¥–µ–∫—Å—ã –≤ –ë–î
- CDN –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏
- Geographic distribution (—Å–µ—Ä–≤–µ—Ä—ã –±–ª–∏–∂–µ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º)
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ payload (compression, pagination)

---

### Throughput (–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å)
**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π**, –∫–æ—Ç–æ—Ä–æ–µ —Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å **–≤ –µ–¥–∏–Ω–∏—Ü—É –≤—Ä–µ–º–µ–Ω–∏**.

**–ò–∑–º–µ—Ä—è–µ—Ç—Å—è –≤:**
- **RPS** (Requests Per Second) - –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É
- **QPS** (Queries Per Second) - –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î –≤ —Å–µ–∫—É–Ω–¥—É
- **TPS** (Transactions Per Second) - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ —Å–µ–∫—É–Ω–¥—É
- **MB/s** –∏–ª–∏ **GB/s** - –¥–ª—è –¥–∞–Ω–Ω—ã—Ö (network, disk)

**–ü—Ä–∏–º–µ—Ä—ã:**
```
–û–¥–∏–Ω web server: 1000 RPS
Nginx: 10,000+ RPS (static content)
PostgreSQL: 10,000+ TPS (simple queries)
Redis: 100,000+ QPS
```

**–°–≤—è–∑—å —Å latency:**
```
–ï—Å–ª–∏ latency = 100ms (0.1s) –¥–ª—è –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
–¢–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π throughput –Ω–∞ –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ = 1/0.1 = 10 RPS

–° 100 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º–∏ –ø–æ—Ç–æ–∫–∞–º–∏: 10 √ó 100 = 1,000 RPS
```

**–ö–∞–∫ —É–≤–µ–ª–∏—á–∏—Ç—å:**
- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ (–±–æ–ª—å—à–µ —Å–µ—Ä–≤–µ—Ä–æ–≤)
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (queues)
- Connection pooling
- Load balancing
- Batch processing

---

### Concurrency (–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å)
**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ–º—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π** –≤ —Å–∏—Å—Ç–µ–º–µ.

**–ü—Ä–∏–º–µ—Ä—ã:**
- –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ HTTP connections –∫ —Å–µ—Ä–≤–µ—Ä—É
- –ê–∫—Ç–∏–≤–Ω—ã–µ workers –≤ –æ—á–µ—Ä–µ–¥–∏
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î
- Concurrent users –≤ —Å–∏—Å—Ç–µ–º–µ

**–¢–∏–ø—ã:**
```
Concurrent users:     1000 —á–µ–ª–æ–≤–µ–∫ –æ–Ω–ª–∞–π–Ω
Active connections:   500 HTTP requests –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
Database connections: 100 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
Background jobs:      50 workers –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –∑–∞–¥–∞—á–∏
```

**–ü—Ä–æ–±–ª–µ–º—ã high concurrency:**
- Race conditions (–¥–≤–∞ –∑–∞–ø—Ä–æ—Å–∞ –º–µ–Ω—è—é—Ç –æ–¥–Ω–∏ –¥–∞–Ω–Ω—ã–µ)
- Deadlocks (–≤–∑–∞–∏–º–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)
- Resource exhaustion (–Ω–µ—Ö–≤–∞—Ç–∫–∞ connections, memory)
- Thread/process limits

**–†–µ—à–µ–Ω–∏—è:**
- Connection pooling (–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π)
- Locks –∏ transactions (ACID –≤ –ë–î)
- Optimistic locking (–≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)
- Message queues (—Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ –ø–∏–∫–æ–≤ –Ω–∞–≥—Ä—É–∑–∫–∏)
- Rate limiting (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

---

### Little's Law (–§–æ—Ä–º—É–ª–∞ –õ–∏—Ç—Ç–ª–∞)

**–§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞** –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º.

```
L = Œª √ó W

–≥–¥–µ:
L - —Å—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ (concurrent requests)
Œª - —Å—Ä–µ–¥–Ω–∏–π throughput (requests/second)
W - —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ (latency –≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
```

### –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è Little's Law:

#### –ü—Ä–∏–º–µ—Ä 1: –°–∫–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ —Å–µ—Ä–≤–µ—Ä–æ–≤?
```
–î–∞–Ω–æ:
- –û–∂–∏–¥–∞–µ–º—ã–π throughput: 1000 RPS
- Latency –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞: 100ms = 0.1s

L = Œª √ó W = 1000 √ó 0.1 = 100 concurrent requests

–ï—Å–ª–∏ –æ–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç 50 concurrent:
–ù—É–∂–Ω–æ —Å–µ—Ä–≤–µ—Ä–æ–≤: 100 / 50 = 2 —Å–µ—Ä–≤–µ—Ä–∞ (–º–∏–Ω–∏–º—É–º)

–° –∑–∞–ø–∞—Å–æ–º (√ó2): 4 —Å–µ—Ä–≤–µ—Ä–∞
```

#### –ü—Ä–∏–º–µ—Ä 2: Database connections pool
```
–î–∞–Ω–æ:
- Throughput –∫ –ë–î: 500 QPS
- –°—Ä–µ–¥–Ω—è—è latency –∑–∞–ø—Ä–æ—Å–∞: 20ms = 0.02s

L = 500 √ó 0.02 = 10 concurrent queries

Connection pool size: –º–∏–Ω–∏–º—É–º 10, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 20-30
```

#### –ü—Ä–∏–º–µ—Ä 3: Queue sizing
```
–î–∞–Ω–æ:
- –ü–æ—Ç–æ–∫ –∑–∞–¥–∞—á: 100 jobs/second
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ job: 5s

L = 100 √ó 5 = 500 jobs –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤ –æ—á–µ—Ä–µ–¥–∏

–ù—É–∂–Ω–æ workers: 500 / (processing capacity) = ?
–ï—Å–ª–∏ 1 worker –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç 1 job –∑–∞ 5s:
–ù—É–∂–Ω–æ 500 workers –ò–õ–ò —É–º–µ–Ω—å—à–∏—Ç—å latency –æ–±—Ä–∞–±–æ—Ç–∫–∏
```

**–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
- Capacity planning (—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–æ–≤ –Ω—É–∂–Ω–æ)
- Queue depth monitoring (—Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏)
- Connection pool sizing (—Ä–∞–∑–º–µ—Ä –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π)
- Performance tuning (–≥–¥–µ bottleneck)

---

### Response Time vs Latency

**Response Time** - –ø–æ–ª–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç –∑–∞–ø—Ä–æ—Å–∞ –∫–ª–∏–µ–Ω—Ç–∞ –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ (–≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –∑–∞–¥–µ—Ä–∂–∫–∏)
```
Response Time = Network latency + Server processing + Database query + Network latency
```

**Latency** - –∑–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —ç—Ç–∞–ø–µ (network, disk, CPU)

**–ü—Ä–∏–º–µ—Ä:**
```
Client ‚Üí [50ms network] ‚Üí Load Balancer ‚Üí [2ms] ‚Üí 
Server ‚Üí [5ms app logic] ‚Üí Database ‚Üí [30ms query] ‚Üí 
Response ‚Üí [50ms network] ‚Üí Client

Total Response Time: 50 + 2 + 5 + 30 + 50 = 137ms
Network latency: 100ms (50 + 50)
Database latency: 30ms
```

---

### Percentiles (–ü—Ä–æ—Ü–µ–Ω—Ç–∏–ª–∏)

–ü—Ä–∏ –∏–∑–º–µ—Ä–µ–Ω–∏–∏ latency **—Å—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è (avg) –æ–±–º–∞–Ω—á–∏–≤—ã**. –ò—Å–ø–æ–ª—å–∑—É—é—Ç percentiles:

```
p50 (median):  50% –∑–∞–ø—Ä–æ—Å–æ–≤ –±—ã—Å—Ç—Ä–µ–µ —ç—Ç–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
p95:           95% –∑–∞–ø—Ä–æ—Å–æ–≤ –±—ã—Å—Ç—Ä–µ–µ
p99:           99% –∑–∞–ø—Ä–æ—Å–æ–≤ –±—ã—Å—Ç—Ä–µ–µ
p99.9:         99.9% –∑–∞–ø—Ä–æ—Å–æ–≤ –±—ã—Å—Ç—Ä–µ–µ
```

**–ü—Ä–∏–º–µ—Ä:**
```
p50 = 100ms   - –ø–æ–ª–æ–≤–∏–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∂–¥—ë—Ç ‚â§100ms
p95 = 500ms   - 5% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∂–¥—É—Ç >500ms
p99 = 2000ms  - 1% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∂–¥—É—Ç >2s
```

**–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ:**
- **Avg = 100ms** –º–æ–∂–µ—Ç —Å–∫—Ä—ã–≤–∞—Ç—å, —á—Ç–æ 1% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∂–¥—É—Ç 10 —Å–µ–∫—É–Ω–¥
- **p99** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç worst-case experience
- **SLA** –æ–±—ã—á–Ω–æ —Å—Ç–∞–≤—è—Ç –Ω–∞ p95 –∏–ª–∏ p99 (–Ω–µ –Ω–∞ avg)

**Targets –¥–ª—è web API:**
```
p50 < 100ms
p95 < 500ms
p99 < 1000ms
p99.9 < 5000ms
```

---

## –ó–∞–∫–æ–Ω—ã –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º

### Amdahl's Law (–ó–∞–∫–æ–Ω –ê–º–¥–∞–ª–∞)

**–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ** –ø—Ä–∏ —Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏–≤–∞–Ω–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã.

**–§–æ—Ä–º—É–ª–∞:**
```
Speedup = 1 / (S + (1-S)/N)

–≥–¥–µ:
S - –¥–æ–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞ (sequential portion) 0-1
N - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤/–ø–æ—Ç–æ–∫–æ–≤
1-S - –¥–æ–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞
```

**–ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è:** –¥–∞–∂–µ –Ω–µ–±–æ–ª—å—à–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π —É—á–∞—Å—Ç–æ–∫ –∫–æ–¥–∞ **–æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç** –æ–±—â–µ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ.

### –ü—Ä–∏–º–µ—Ä—ã Amdahl's Law:

#### –ü—Ä–∏–º–µ—Ä 1: 5% –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞
```
S = 0.05 (5% –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–¥)
1-S = 0.95 (95% –º–æ–∂–Ω–æ —Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏—Ç—å)

–° N=2 –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞–º–∏:  Speedup = 1 / (0.05 + 0.95/2)  = 1.90x
–° N=10 –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞–º–∏: Speedup = 1 / (0.05 + 0.95/10) = 6.89x
–° N=100 –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞–º–∏: Speedup = 1 / (0.05 + 0.95/100) = 16.8x
–° N=‚àû –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞–º–∏:  Speedup max = 1 / 0.05 = 20x ‚ùå –ø–æ—Ç–æ–ª–æ–∫!
```

**–í—ã–≤–æ–¥:** –¥–∞–∂–µ —Å –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏ –º–∞–∫—Å–∏–º—É–º 20x –∏–∑-–∑–∞ 5% –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞.

#### –ü—Ä–∏–º–µ—Ä 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫–∞–∑–æ–≤
```
–ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞:
1. –í–∞–ª–∏–¥–∞—Ü–∏—è (10ms) - –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–û ‚ùå
2. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ (90ms) - –º–æ–∂–Ω–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ ‚úÖ
3. –°–æ–∑–¥–∞–Ω–∏–µ —Å—á—ë—Ç–∞ (10ms) - –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–û ‚ùå

S = (10 + 10) / 110 = 0.18 (18% –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ)

–° 10 —Å–µ—Ä–≤–µ—Ä–∞–º–∏: Speedup = 1 / (0.18 + 0.82/10) = 4.59x
–ú–∞–∫—Å–∏–º—É–º –≤–æ–∑–º–æ–∂–Ω–æ: 1 / 0.18 = 5.56x (–¥–∞–∂–µ —Å 1000 —Å–µ—Ä–≤–µ—Ä–æ–≤!)
```

**–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
- **–ù–µ –¥–æ–±–∞–≤–ª—è–π —Å–µ—Ä–≤–µ—Ä—ã –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ** - –µ—Å—Ç—å –ø—Ä–µ–¥–µ–ª –∏–∑-–∑–∞ sequential —á–∞—Å—Ç–∏
- **–ù–∞–π–¥–∏ bottleneck:** –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏
- **Database locks** - —á–∞—Å—Ç–æ —è–≤–ª—è—é—Ç—Å—è sequential bottleneck
- **Single-threaded operations** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏) –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

---

### Gustafson's Law (–ó–∞–∫–æ–Ω –ì—É—Å—Ç–∞—Ñ—Å–æ–Ω–∞)

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∑–≥–ª—è–¥:** –≤–º–µ—Å—Ç–æ —É—Å–∫–æ—Ä–µ–Ω–∏—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏, —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º **–æ–±—ä—ë–º —Ä–∞–±–æ—Ç—ã**.

**–§–æ—Ä–º—É–ª–∞:**
```
Scaled Speedup = S + N(1-S)

–≥–¥–µ:
S - –¥–æ–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞
N - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤
```

**–ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è:** —Å —Ä–æ—Å—Ç–æ–º —Ä–µ—Å—É—Ä—Å–æ–≤ –º—ã **—É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –æ–±—ä—ë–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö**, –∞ –Ω–µ —É—Å–∫–æ—Ä—è–µ–º —Ç—É –∂–µ –∑–∞–¥–∞—á—É.

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: Amdahl vs Gustafson

| –í–æ–ø—Ä–æ—Å | Amdahl | Gustafson |
|--------|--------|-----------|
| **–¶–µ–ª—å** | –£—Å–∫–æ—Ä–µ–Ω–∏–µ (speedup) | –û–±—ä—ë–º —Ä–∞–±–æ—Ç—ã (throughput) |
| **–§–æ–∫—É—Å** | –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞ –±—ã—Å—Ç—Ä–µ–µ | –ë–æ–ª—å—à–µ –∑–∞–¥–∞—á –∑–∞ —Ç–æ –∂–µ –≤—Ä–µ–º—è |
| **–ü–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–Ω—ã–π/–û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–π** | –ü–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–Ω—ã–π (–µ—Å—Ç—å –ø—Ä–µ–¥–µ–ª) | –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–π (–ª–∏–Ω–µ–π–Ω—ã–π —Ä–æ—Å—Ç) |
| **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ** | Latency-–∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã | Throughput-–∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã |

### –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:

#### Amdahl (—É—Å–∫–æ—Ä–µ–Ω–∏–µ):
```
–ó–∞–¥–∞—á–∞: –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å 1 –≤–∏–¥–µ–æ –∑–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
–¶–µ–ª—å: —Å–Ω–∏–∑–∏—Ç—å latency —Å 10 –º–∏–Ω—É—Ç –¥–æ 1 –º–∏–Ω—É—Ç—ã

–ü—Ä–æ–±–ª–µ–º–∞: –µ—Å—Ç—å sequential —á–∞—Å—Ç–∏ (–¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è)
–†–µ—à–µ–Ω–∏–µ: –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏
```

#### Gustafson (–æ–±—ä—ë–º):
```
–ó–∞–¥–∞—á–∞: –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –º–∞–∫—Å–∏–º—É–º –≤–∏–¥–µ–æ –∑–∞ —á–∞—Å
–¶–µ–ª—å: —É–≤–µ–ª–∏—á–∏—Ç—å throughput —Å 6 –≤–∏–¥–µ–æ/—á–∞—Å –¥–æ 60 –≤–∏–¥–µ–æ/—á–∞—Å

–†–µ—à–µ–Ω–∏–µ: –¥–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä—ã, –∫–∞–∂–¥—ã–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–≤–æ–∏ –≤–∏–¥–µ–æ  
–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—á—Ç–∏ –ª–∏–Ω–µ–π–Ω–æ–µ! üéâ
```

**–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ System Design:**

**–ò—Å–ø–æ–ª—å–∑—É–π Amdahl –º—ã—à–ª–µ–Ω–∏–µ –∫–æ–≥–¥–∞:**
- User waiting (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∂–¥—ë—Ç –æ—Ç–≤–µ—Ç–∞)
- Real-time processing (–Ω—É–∂–µ–Ω –±—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç)
- Interactive features (–ø–æ–∏—Å–∫, autocomplete)
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ bottleneck

**–ò—Å–ø–æ–ª—å–∑—É–π Gustafson –º—ã—à–ª–µ–Ω–∏–µ –∫–æ–≥–¥–∞:**
- Batch processing (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–æ–≤)
- Background jobs (email —Ä–∞—Å—Å—ã–ª–∫–∞, –æ—Ç—á—ë—Ç—ã)
- Data analytics (MapReduce, Hadoop)
- –ü—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤—å —Å–µ—Ä–≤–µ—Ä–æ–≤ –¥–ª—è –±–æ–ª—å—à–µ–≥–æ throughput

---

## Contention (–ö–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è –∑–∞ —Ä–µ—Å—É—Ä—Å—ã)

**Contention** - —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ **–Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∫–æ–Ω–∫—É—Ä–∏—Ä—É—é—Ç** –∑–∞ –¥–æ—Å—Ç—É–ø –∫ –æ–±—â–µ–º—É —Ä–µ—Å—É—Ä—Å—É, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –∑–∞–º–µ–¥–ª–µ–Ω–∏—é.

### –¢–∏–ø—ã Contention:

#### 1. Lock Contention (–∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è –∑–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)
```php
// –ü–ª–æ—Ö–æ: –≤—Å–µ –ø–æ—Ç–æ–∫–∏ –∂–¥—É—Ç –æ–¥–Ω—É –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
$lock->acquire();  // üëà high contention!
$counter++;
$lock->release();

// 1000 –ø–æ—Ç–æ–∫–æ–≤ ‚Üí –±–æ–ª—å—à–∞—è —á–∞—Å—Ç—å –≤—Ä–µ–º–µ–Ω–∏ –∂–¥—É—Ç lock
// Throughput –ø–∞–¥–∞–µ—Ç –≤–º–µ—Å—Ç–æ —Ä–æ—Å—Ç–∞
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- Database row locks (UPDATE –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏ –∏–∑ –º–Ω–æ–≥–∏—Ö –ø–æ—Ç–æ–∫–æ–≤)
- Mutex/Semaphore –≤ –∫–æ–¥–µ
- Redis single-threaded (–≤—Å–µ –∫–æ–º–∞–Ω–¥—ã —á–µ—Ä–µ–∑ –æ–¥–∏–Ω –ø–æ—Ç–æ–∫)

**–†–µ—à–µ–Ω–∏—è:**
- **Optimistic locking** (–≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–º–µ—Å—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫)
- **Sharding** (—Ä–∞–∑–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å —Ä–∞–∑–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏)
- **Lock-free structures** (atomic operations)
- **Reduce lock scope** (–¥–µ—Ä–∂–∞—Ç—å lock –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è)

#### 2. CPU Contention
```
10 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –Ω–∞ 4 CPU cores
‚Üí –ø—Ä–æ—Ü–µ—Å—Å—ã –∫–æ–Ω–∫—É—Ä–∏—Ä—É—é—Ç –∑–∞ CPU –≤—Ä–µ–º—è
‚Üí context switching overhead
‚Üí –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–∞–¥–∞–µ—Ç
```

**–†–µ—à–µ–Ω–∏—è:**
- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ (–±–æ–ª—å—à–µ CPU)
- Async I/O (–Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å CPU –Ω–∞ I/O)
- CPU affinity (–ø—Ä–∏–≤—è–∑–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã –∫ —è–¥—Ä–∞–º)

#### 3. Memory Contention
```
–ú–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —á–∏—Ç–∞—é—Ç/–ø–∏—à—É—Ç –≤ –æ–¥–Ω—É –æ–±–ª–∞—Å—Ç—å –ø–∞–º—è—Ç–∏
‚Üí cache invalidation
‚Üí false sharing (–¥–≤–∞ –ø–æ—Ç–æ–∫–∞ —Ç—Ä–æ–≥–∞—é—Ç —Ä–∞–∑–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –æ–¥–Ω–æ–π cache line)
```

#### 4. Network Contention
```
1000 –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ ‚Üí network bandwidth limit
‚Üí packet loss, retransmissions
‚Üí latency —Ä–∞—Å—Ç—ë—Ç
```

#### 5. Disk I/O Contention
```
–ú–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —á–∏—Ç–∞—é—Ç/–ø–∏—à—É—Ç –Ω–∞ –æ–¥–∏–Ω –¥–∏—Å–∫
‚Üí disk seeks —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç—Å—è
‚Üí HDD –æ—Å–æ–±–µ–Ω–Ω–æ –º–µ–¥–ª–µ–Ω–Ω—ã–π (sequential ‚Üí random access)
```

**–†–µ—à–µ–Ω–∏—è:**
- SSD –≤–º–µ—Å—Ç–æ HDD (–ª—É—á—à–µ random access)
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ RAM (Redis)
- Async I/O, buffering

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä: Database Hot Rows

**–ü—Ä–æ–±–ª–µ–º–∞:**
```sql
-- 1000 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–±–Ω–æ–≤–ª—è—é—Ç –æ–¥–∏–Ω —Å—á—ë—Ç—á–∏–∫
UPDATE counters SET views = views + 1 WHERE page_id = 123;

-- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∂–¥—ë—Ç lock ‚Üí high contention
-- Latency —Ä–∞—Å—Ç—ë—Ç –æ—Ç 10ms –¥–æ 1000ms+
```

**–†–µ—à–µ–Ω–∏–µ 1: Sharding**
```sql
-- –†–∞–∑–±–∏—Ç—å —Å—á—ë—Ç—á–∏–∫ –Ω–∞ 10 shard'–æ–≤
UPDATE counters SET views = views + 1 
WHERE page_id = 123 AND shard_id = (RANDOM() % 10);

-- –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: SUM(views) –ø–æ –≤—Å–µ–º shards
-- Contention —Å–Ω–∏–∂–µ–Ω –≤ 10 —Ä–∞–∑
```

**–†–µ—à–µ–Ω–∏–µ 2: Async aggregation**
```php
// –ù–µ –æ–±–Ω–æ–≤–ª—è—Ç—å –ë–î —Å—Ä–∞–∑—É, –ø–∏—Å–∞—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å
Redis::incr("page:123:views");

// Background worker —Ä–∞–∑ –≤ –º–∏–Ω—É—Ç—É –ø–∏—à–µ—Ç –≤ –ë–î
// Contention –ø–æ—á—Ç–∏ –Ω–µ—Ç
```

---

## Coherence (–ö–æ–≥–µ—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å –∫–µ—à–µ–π)

**Coherence** - —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É **—Ä–∞–∑–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏** (–∫–µ—à–∞–º–∏, —Ä–µ–ø–ª–∏–∫–∞–º–∏).

### Cache Coherence Problem

**–ü—Ä–æ–±–ª–µ–º–∞:** –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –æ–±—ä–µ–∫—Ç –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω –Ω–∞ **–Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö**.

```
User –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å:
Server 1: UPDATE database SET name = 'John' WHERE id = 123
Server 1 cache: name = 'John' ‚úÖ

–ù–û:
Server 2 cache: name = 'Bob' ‚ùå (—Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ!)
Server 3 cache: name = 'Bob' ‚ùå
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** —Ä–∞–∑–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ä–∞–∑–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Üí inconsistency.

### –†–µ—à–µ–Ω–∏—è Cache Coherence:

#### 1. Cache Invalidation (–∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è)
```php
// –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ - —É–¥–∞–ª–∏—Ç—å –∏–∑ –≤—Å–µ—Ö –∫–µ—à–µ–π
function updateUser($id, $data) {
    DB::update('users', $id, $data);
    
    // –ò–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫–µ—à –Ω–∞ –í–°–ï–• —Å–µ—Ä–≤–µ—Ä–∞—Ö
    Cache::tags(['user:'.$id])->flush();  // Redis pub/sub
}

// –°–ª–µ–¥—É—é—â–∏–π read –±—É–¥–µ—Ç —Å–≤–µ–∂–∏–π –∏–∑ –ë–î
```

**–ü–ª—é—Å—ã:** –ø—Ä–æ—Å—Ç–æ—Ç–∞  
**–ú–∏–Ω—É—Å—ã:** cache stampede (–≤—Å–µ —Å—Ä–∞–∑—É –∏–¥—É—Ç –≤ –ë–î)

#### 2. Write-Through Cache
```php
// –û–±–Ω–æ–≤–ª—è–µ–º –ë–î + –∫–µ—à –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
function updateUser($id, $data) {
    DB::update('users', $id, $data);
    Cache::put('user:'.$id, $data);  // –æ–±–Ω–æ–≤–∏—Ç—å –∫–µ—à
    
    // Broadcast to other servers
    Redis::publish('cache:invalidate', 'user:'.$id);
}
```

#### 3. Centralized Cache (Redis)
```
–ù–ï –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–µ—Ä–µ –ª–æ–∫–∞–ª—å–Ω–æ
–í–ú–ï–°–¢–û: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—â–∏–π Redis –∫–µ—à

Server 1 ‚Üí Redis ‚Üê Server 2
         ‚Üë
      Server 3

–í—Å–µ —Å–º–æ—Ç—Ä—è—Ç –≤ –æ–¥–Ω–æ –º–µ—Å—Ç–æ ‚Üí –Ω–µ—Ç coherence –ø—Ä–æ–±–ª–µ–º—ã
```

**–ü–ª—é—Å—ã:** –Ω–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã coherence  
**Minuses:** Redis —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è SPOF (–Ω–æ –º–æ–∂–Ω–æ Redis cluster)

#### 4. Event-Driven Invalidation
```php
// –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ
event(new UserUpdated($user));

// –í—Å–µ —Å–µ—Ä–≤–µ—Ä—ã —Å–ª—É—à–∞—é—Ç –∏ –æ–±–Ω–æ–≤–ª—è—é—Ç —Å–≤–æ–π –∫–µ—à
class InvalidateUserCache {
    public function handle(UserUpdated $event) {
        Cache::forget('user:'.$event->user->id);
    }
}
```

### Database Replication Coherence

**–ü—Ä–æ–±–ª–µ–º–∞:** master-slave —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π.

```
Write to Master: name = 'John'
                    ‚Üì replication lag 100ms
Read from Slave:  name = 'Bob' ‚ùå (–µ—â–µ –Ω–µ —Ä–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–ª–æ—Å—å)
```

**–†–µ—à–µ–Ω–∏—è:**

**1. Read-Your-Writes Consistency**
```php
// –ü–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏ - —á–∏—Ç–∞—Ç—å —Å master (–Ω–µ slave)
function updateAndShow($id) {
    DB::connection('master')->update(...);
    
    // –ß–∏—Ç–∞—Ç—å —Å master –≤ —Ç–µ—á–µ–Ω–∏–µ 5 —Å–µ–∫—É–Ω–¥
    return DB::connection('master')->find($id);
}
```

**2. Session Stickiness**
```
User –≤—Å–µ–≥–¥–∞ –∏–¥—ë—Ç –Ω–∞ —Ç–æ—Ç –∂–µ —Å–µ—Ä–≤–µ—Ä/replica
‚Üí –≤–∏–¥–∏—Ç —Å–≤–æ–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
```

**3. Version Numbers**
```php
// –ü—Ä–∏ –∑–∞–ø–∏—Å–∏ - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–µ—Ä—Å–∏—é
$version = DB::insert(...);  // version = 42

// –ü—Ä–∏ —á—Ç–µ–Ω–∏–∏ - —Ç—Ä–µ–±–æ–≤–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é
DB::slave()->where('version', '>=', 42)->get();
// –ï—Å–ª–∏ slave –æ—Ç—Å—Ç–∞–ª - fallback –Ω–∞ master
```

---

## CAP Theorem

**CAP —Ç–µ–æ—Ä–µ–º–∞** - –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ç—Ä–∏ —Å–≤–æ–π—Å—Ç–≤–∞:

### –¢—Ä–∏ —Å–≤–æ–π—Å—Ç–≤–∞:

- **C (Consistency)** - –≤—Å–µ —É–∑–ª—ã –≤–∏–¥—è—Ç –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- **A (Availability)** - –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç (—É—Å–ø–µ—Ö –∏–ª–∏ –æ—à–∏–±–∫–∞)
- **P (Partition Tolerance)** - —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏

**–ü—Ä–∞–≤–∏–ª–æ:** –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ 2 –∏–∑ 3.

### –ü—Ä–∏–º–µ—Ä—ã —Å–∏—Å—Ç–µ–º:

#### CP (Consistency + Partition Tolerance)
- **MongoDB** (–≤ —Ä–µ–∂–∏–º–µ replica set)
- **HBase**
- **Redis** (single master)
- –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Å–∏—Å—Ç–µ–º—ã

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –ü—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ —Å–µ—Ç–∏ —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–∫–∞–∂–µ—Ç –≤ –∑–∞–ø—Ä–æ—Å–µ, –Ω–æ –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞–Ω—É—Ç—Å—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–º–∏.

#### AP (Availability + Partition Tolerance)
- **Cassandra**
- **DynamoDB**
- **Riak**
- DNS —Å–∏—Å—Ç–µ–º—ã

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –ü—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ —Å–µ—Ç–∏ —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–≤–µ—Ç–∏—Ç (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç–∞—Ä—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏), eventual consistency.

#### CA (Consistency + Availability)
- **PostgreSQL** (single node)
- **MySQL** (single node)

**–í–∞–∂–Ω–æ:** –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω–µ—Ç –∏—Å—Ç–∏–Ω–Ω–æ CA —Å–∏—Å—Ç–µ–º –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å—Ä–µ–¥–µ, —Ç–∞–∫ –∫–∞–∫ —Å–µ—Ç–µ–≤—ã–µ —Ä–∞–∑—Ä—ã–≤—ã –Ω–µ–∏–∑–±–µ–∂–Ω—ã.

---

## Consistency Models

### Strong Consistency (–°—Ç—Ä–æ–≥–∞—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å)
- –í—Å–µ —á–∏—Ç–∞—é—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é –∑–∞–ø–∏—Å–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é
- –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è
- –í—ã—Å–æ–∫–∞—è latency

**–ü—Ä–∏–º–µ—Ä:**
```
Write(x=1) ‚Üí —É—Å–ø–µ—Ö
Read(x) ‚Üí –≤—Å–µ–≥–¥–∞ –≤–µ—Ä–Ω—ë—Ç 1
```

### Eventual Consistency (Eventual –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å)
- –î–∞–Ω–Ω—ã–µ –≤ –∏—Ç–æ–≥–µ —Å—Ç–∞–Ω—É—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –Ω–∞ –≤—Å–µ—Ö —É–∑–ª–∞—Ö
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è
- –ù–∏–∑–∫–∞—è latency, –≤—ã—Å–æ–∫–∞—è availability

**–ü—Ä–∏–º–µ—Ä:**
```
Write(x=1) ‚Üí —É—Å–ø–µ—Ö
Read(x) ‚Üí –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –Ω–æ –ø–æ—Ç–æ–º —Å—Ç–∞–Ω–µ—Ç 1
```

### –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:
- **Strong:** –±–∞–Ω–∫–∏, –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å  
- **Eventual:** —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

---

## ACID vs BASE

### ACID (SQL databases)

- **Atomicity** - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ª–∏–±–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é, –ª–∏–±–æ –Ω–µ—Ç
- **Consistency** - –¥–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ –≤ –≤–∞–ª–∏–¥–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
- **Isolation** - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ –≤–ª–∏—è—é—Ç –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞
- **Durability** - –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ commit

### BASE (NoSQL databases)

- **Basically Available** - —Å–∏—Å—Ç–µ–º–∞ –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞
- **Soft state** - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º (eventual)
- **Eventually consistent** - –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞–Ω—É—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–º–∏

---

## Availability & SLA

### –ü—Ä–æ—Ü–µ–Ω—Ç—ã –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏:

| SLA | Downtime/–≥–æ–¥ | Downtime/–º–µ—Å—è—Ü | Use Case |
|-----|--------------|----------------|----------|
| 99% | 3.65 –¥–Ω–µ–π | 7.2 —á–∞—Å–∞ | –ù–∏–∑–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã |
| 99.9% | 8.76 —á–∞—Å–æ–≤ | 43.2 –º–∏–Ω—É—Ç—ã | –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π |
| 99.99% | 52.56 –º–∏–Ω—É—Ç | 4.32 –º–∏–Ω—É—Ç—ã | –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –±–∏–∑–Ω–µ—Å-—Å–µ—Ä–≤–∏—Å—ã |
| 99.999% | 5.26 –º–∏–Ω—É—Ç | 26 —Å–µ–∫—É–Ω–¥ | –¢–µ–ª–µ–∫–æ–º, —Ñ–∏–Ω–∞–Ω—Å—ã |

### –ö–∞–∫ –¥–æ—Å—Ç–∏—á—å –≤—ã—Å–æ–∫–æ–π availability:

1. **Redundancy** - –Ω–µ—Ç single point of failure
2. **Health checks** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
3. **Graceful degradation** - —á–∞—Å—Ç–∏—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
4. **Auto-scaling** - –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –Ω–∞–≥—Ä—É–∑–∫–µ

---

## Reliability vs Redundancy

### Reliability (–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å)
–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ç–æ–≥–æ, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ —Å–±–æ–µ–≤.

**MTBF (Mean Time Between Failures)** - —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –º–µ–∂–¥—É —Å–±–æ—è–º–∏  
**MTTR (Mean Time To Repair)** - —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

```
Availability = MTBF / (MTBF + MTTR)
```

### Redundancy (–ò–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å)
–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è single point of failure.

**–ü—Ä–∏–º–µ—Ä—ã:**
- Multiple servers (load balancing)
- Database replication (master-slave)
- Multiple availability zones
- Geographic redundancy

---

## Single Point of Failure (SPOF)

**SPOF** - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –æ—Ç–∫–∞–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –æ—Ç–∫–∞–∑—É –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã.

### –ü—Ä–∏–º–µ—Ä—ã SPOF:
- –û–¥–∏–Ω application server
- –û–¥–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (master)
- –û–¥–∏–Ω load balancer

### –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ SPOF:
- Active-Passive failover
- Active-Active load balancing
- Database replication
- Multi-AZ deployment

---

## Horizontal vs Vertical Scaling

### Vertical Scaling (–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ)
–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –º–æ—â–Ω–æ—Å—Ç–∏ –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–±–æ–ª—å—à–µ CPU, RAM, –¥–∏—Å–∫–æ–≤).

**–ü–ª—é—Å—ã:**
- –ü—Ä–æ—â–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å
- –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é

**–ú–∏–Ω—É—Å—ã:**
- Hardware limits
- Downtime –ø—Ä–∏ upgrade
- –î–æ—Ä–æ–≥–æ

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –Ω–µ–±–æ–ª—å—à–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, legacy –º–æ–Ω–æ–ª–∏—Ç—ã.

### Horizontal Scaling (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ)
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–æ–ª—å—à–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤.

**–ü–ª—é—Å—ã:**
- –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ—Ç –ª–∏–º–∏—Ç–æ–≤
- Fault tolerance (–∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å)
- Cost-effective (commodity hardware)

**–ú–∏–Ω—É—Å—ã:**
- –°–ª–æ–∂–Ω–µ–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ
- –ü—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é
- Network overhead

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, microservices.

---

## Data Replication

### Master-Slave (Leader-Follower)
```
Master (write + read) ‚Üí Slave1 (read)
                      ‚Üí Slave2 (read)
```

**–ü–ª—é—Å—ã:**
- –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ read –æ–ø–µ—Ä–∞—Ü–∏–π
- –ë—ç–∫–∞–ø—ã

**–ú–∏–Ω—É—Å—ã:**
- Single point of failure (master)
- Replication lag

### Master-Master (Multi-Leader)
```
Master1 ‚áÑ Master2
```

**–ü–ª—é—Å—ã:**
- –ù–µ—Ç single point of failure
- Write –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è

**–ú–∏–Ω—É—Å—ã:**
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∑–∞–ø–∏—Å–∏
- –°–ª–æ–∂–Ω–∞—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

### Peer-to-Peer (Leaderless)
–ü—Ä–∏–º–µ—Ä—ã: Cassandra, DynamoDB

**–ü–ª—é—Å—ã:**
- –ù–µ—Ç single point of failure
- –í—ã—Å–æ–∫–∞—è availability

**–ú–∏–Ω—É—Å—ã:**
- Eventual consistency
- –°–ª–æ–∂–Ω–æ—Å—Ç—å

---

## Partitioning / Sharding

–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ë–î.

### Horizontal Partitioning (Sharding)
```
Users 1-1000   ‚Üí Shard 1
Users 1001-2000 ‚Üí Shard 2
```

**–°—Ç—Ä–∞—Ç–µ–≥–∏–∏:**
- **Range-based:** –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º (1-1000, 1001-2000)
- **Hash-based:** hash(user_id) % num_shards
- **Geo-based:** –ø–æ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏

### Vertical Partitioning
```
users table ‚Üí user_profile, user_auth (—Ä–∞–∑–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã/–ë–î)
```

### –ü—Ä–æ–±–ª–µ–º—ã:
- Joins –º–µ–∂–¥—É shards
- Rebalancing
- Hotspots

---

## Resources

- [Designing Data-Intensive Applications](https://dataintensive.net/) - Martin Kleppmann
- [System Design Primer](https://github.com/donnemartin/system-design-primer)
- [CAP Theorem Explained](https://www.ibm.com/topics/cap-theorem)
